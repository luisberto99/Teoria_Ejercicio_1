<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./styles.css">
    <title>Ejercicio 1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var poblacion = [];
        var poblacionFem = [];
    </script>
    <script>
        function calcular() {
            poblacion = [];
            var numeroAnhos = parseInt(document.getElementById("input_anhos").value)
            var poblacionMasculina = parseInt(document.getElementById("input_masc").value)
            var poblacionFemenina = parseInt(document.getElementById("input_fem").value)
            var mortalidadMasculina = parseInt(document.getElementById("tasa_mort_masc").value) / 100
            var mortalidadFemenina = parseInt(document.getElementById("tasa_mort_fem").value) / 100
            var natalidadMasculina = parseInt(document.getElementById("tasa_nat_masc").value) / 100
            var natalidadFemenina = parseInt(document.getElementById("tasa_nat_fem").value) / 100
            var poblacionFertil = parseInt(document.getElementById("num_mujeres_fertil").value)

            //TODO VERIFICAR QUE TODOS LOS CAMPOS SEAN VALIDOS

            calculoPoplacionMasc(numeroAnhos, poblacionMasculina, natalidadMasculina, mortalidadMasculina);
            calculoPoplacionFem(numeroAnhos,poblacionFemenina, natalidadFemenina, mortalidadFemenina)
            numNacimientos = poblacionMasculina * natalidadMasculina + poblacionFemenina * natalidadFemenina;
            //console.log(calculoFecundidad(numNacimientos, poblacionFertil));
            const labels = [];
            for(let i=1;i<=numeroAnhos;i++){
                labels.push(i)
            }
            
            const data = {
                labels:labels,
                datasets: [{
                        label: 'Grafica de Poblacion Masculina',
                        backgroundColor: 'rgb(255, 99, 132)',
                        borderColor: 'rgb(255, 99, 132)',
                        data: poblacion,
                    },
                    {
                        label: 'Grafica de Poblacion Femenina',
                        backgroundColor: 'rgb(255, 5, 236)',
                        borderColor: 'rgb(255, 5, 236)',
                        data: poblacionFem, 
                    }
                ]
            };
            const config = {
                type: 'line',
                data: data,
                options: {
                  responsive: true,
                  plugins: {
                    legend: {
                      position: 'top',
                    },
                    title: {
                      display: true,
                      text: 'Chart.js Line Chart'
                    }
                  }
                },
            };
            const myChart = new Chart(
            document.getElementById('myChart'),
                config
            );
        }   
    </script>
    <script>
        function calculoPoplacionMasc(n, p, tasa_nat, tasa_mort) {
            if (n == 0) {
                return p;
            } else {
                anhoAnterior = calculoPoplacionMasc(n - 1, p, tasa_nat, tasa_mort);
                poblacionActual = Math.round(anhoAnterior + anhoAnterior * tasa_nat - anhoAnterior * tasa_mort);
                poblacion.push(poblacionActual);
            
                return poblacionActual;
            }
        }
        function calculoPoplacionFem(n, p, tasa_nat, tasa_mort) {
            if (n == 0) {
                return p;
            } else {
                anhoAnterior = calculoPoplacionFem(n - 1, p, tasa_nat, tasa_mort);
                poblacionActual = Math.round(anhoAnterior + anhoAnterior * tasa_nat - anhoAnterior * tasa_mort);
                poblacionFem.push(poblacionActual);
            
                return poblacionActual;
            }
        }
    </script>
    <script>
        function calculoFecundidad(numNacimientos, pf) {
            //TODO CALCULAR POR AÑO
            return numNacimientos / pf * 10;
        }
    </script>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-5">
                <div id="formulario" class="container">
                    <h2>Datos de poblacion</h2>

                    <label for="input_masc" class="form-label">Poblacion Masculina</label>
                    <input type="number" id="input_masc" class="form-control"><br>

                    <label for="input_fem" class="form-label">Poblacion Femenina</label>
                    <input type="number" id="input_fem" class="form-control"><br>

                    <label for="tasa_mort_masc" class="form-label">Tasa de mortalidad Masculina</label>
                    <div class="input-group">
                        <input type="number" id="tasa_mort_masc" class="form-control">
                        <span class="input-group-text">%</span>
                    </div><br>


                    <label for="tasa_mort_fem" class="form-label">Tasa de mortalidad Femenina</label>
                    <div class="input-group">
                        <input type="number" id="tasa_mort_fem" class="form-control">
                        <span class="input-group-text">%</span>
                    </div><br>


                    <label for="tasa_nat_masc" class="form-label">Tasa de natalidad Masculina</label>
                    <div class="input-group">
                        <input type="number" id="tasa_nat_masc" class="form-control">
                        <span class="input-group-text">%</span>
                    </div><br>

                    <label for="tasa_nat_fem" class="form-label">Tasa de natalidad Femenina</label>
                    <div class="input-group">
                        <input type="number" id="tasa_nat_fem" class="form-control">
                        <span class="input-group-text">%</span>
                    </div><br>


                    <label for="num_mujeres_fertil" class="form-label">Numero de mujeres fertiles</label>
                    <input type="number" id="num_mujeres_fertil" class="form-control"><br>
                </div><br>
                <div id="formulario2" class="container">
                    <h2>Datos de simulación</h2>

                    <label for="input_anhos" class="form-label">Cantidad de años a simular</label>
                    <input type="number" id="input_anhos" class="form-control"><br>
                    <button class="btn btn-primary" onclick="calcular()">Calcular</button>
                </div>
            </div>
            <div class="col-7">
                <div id="grafica_poblacion">
                    <canvas id="myChart"></canvas>
                    <div id="scripting"></div>
                </div>
                <div id="res_fecundidad">

                </div>
            </div>
        </div>
    </div>
</body>

</html>